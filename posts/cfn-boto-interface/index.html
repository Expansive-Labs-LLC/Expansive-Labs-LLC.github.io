<!-- src/layouts/post.njk -->
<!--
=========================================================
* Soft UI PRO - v1.0.1
=========================================================

* Product Page: https://www.creative-tim.com/product/soft-ui-design-system-pro
* Copyright 2021 Creative Tim (https://www.creative-tim.com)

Coded by www.creative-tim.com

 =========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cfn-boto-interface</title>

    <!-- Include Soft UI Styles -->
    <link rel="stylesheet" href="/static/assets/css/main.css">
</head>
<body>
    <!-- Navbar (Include your theme’s navbar if applicable) -->
    
    <div class="container position-sticky z-index-sticky top-0">
    <div class="row">
      <div class="col-12">
        <nav class="navbar navbar-expand-lg  blur blur-rounded top-0  z-index-3 shadow position-absolute mt-4 my-3 py-2 start-0 end-0 mx-4">
          <div class="container-fluid">
            <a class="navbar-brand font-weight-bolder ms-sm-3" href="/" rel="tooltip" title="Designed and Coded by Creative Tim" data-placement="bottom">
              Expansive Labs
            </a>
            <button class="navbar-toggler shadow-none ms-2" type="button" data-bs-toggle="collapse" data-bs-target="#navigation" aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon mt-2">
                <span class="navbar-toggler-bar bar1"></span>
                <span class="navbar-toggler-bar bar2"></span>
                <span class="navbar-toggler-bar bar3"></span>
              </span>
            </button>
            <div class="collapse navbar-collapse pt-3 pb-2 py-lg-0" id="navigation">
              <ul class="navbar-nav navbar-nav-hover mx-auto">
               <li class="nav-item dropdown dropdown-hover mx-2">
                  <div class="dropdown-menu dropdown-menu-animation dropdown-xl p-3 border-radius-xl mt-0 mt-lg-3" aria-labelledby="dropdownMenuPages">
                    <div class="row d-none d-lg-block">
                      <div class="col-12 px-4 py-2">
                        <div class="row">
                          <div class="col-6 position-relative">
                              <div class="d-inline-block">
                                <div class="icon icon-shape icon-xs border-radius-md bg-gradient-primary text-center me-2 d-flex align-items-center justify-content-center">
                                </div>
                              </div>
                              <div class="d-inline-block">
                                <div class="icon icon-shape icon-xs border-radius-md bg-gradient-primary text-center me-2 d-flex align-items-center justify-content-center ps-0">
                                </div>
                              </div>
                          </div>
                          <div class="col-6 position-relative">
                            <h6 class="dropdown-header text-dark font-weight-bolder d-flex justify-content-cente align-items-center px-0">
                              <div class="d-inline-block">
                                <div class="icon icon-shape icon-xs border-radius-md bg-gradient-primary text-center me-2 d-flex align-items-center justify-content-center ps-0">
                                </div>
                              </div>
                            </h6>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </li>
                <li class="nav-item mx-2">
                <a class="nav-link ps-2 d-flex justify-content-between font-weight-bold cursor-pointer align-items-center" href="/about-us/">About Us</a>
                </li>
                <li class="nav-item mx-2">
                <a class="nav-link ps-2 d-flex justify-content-between font-weight-bold cursor-pointer align-items-center" href="/team/">Team</a>
                </li>
                <li class="nav-item mx-2">
                <a class="nav-link ps-2 d-flex justify-content-between font-weight-bold cursor-pointer align-items-center" href="/playlists/">Playlists</a>
                </li>
                <li class="nav-item mx-2">
                <a class="nav-link ps-2 d-flex justify-content-between font-weight-bold cursor-pointer align-items-center" href="/blog/">Blog</a>
                </li>
            </div>
          </div>
        </nav>
      </div>
    </div>
  </div>


    <div class="container mt-5">
        <article class="card shadow-lg p-4">
            

            <h1 class="mt-3">cfn-boto-interface</h1>
            <p class="text-muted"><strong></strong> - 2018-04-12</p>

            <div class="content">
                <h1><a href="https://github.com/dejonghe/cfn-boto-interface">cfn-boto-interface</a></h1>
<h2>Note: This should no longer be used, in favor of AWS CDK.</h2>
<h2>What is it?</h2>
<p>Possibly the most dangerous thing I’ve ever written.</p>
<p>This is python3.6 code that is intended to run inside of AWS Lambda. The Lambda Function is intended to be used as a CloudFormation Custom Resource. This Custom Resource takes properties that describe a set of commands to run. It allows you to look up data from the event source, response objects returned by other commands, modify lookups to cast to <code>int</code> or <code>str</code>, and also interpolate random strings.</p>
<h2>Where is it?</h2>
<p>GitHub: <a href="https://github.com/dejonghe/cfn-boto-interface">https://github.com/dejonghe/cfn-boto-interface</a></p>
<h2>Why I wrote this</h2>
<p>I often find myself writing custom resources for things that either are not yet supported by CloudFormation, or for things that seem like they will never be supported, like a lookup. Often these custom resources are just a few boto3 calls that create, update, and delete a given resource. I has started to look at spot fleets for running ECS clusters after the pricing model changed in March 2018. The EC2 Launch Template was not supported at that time and neither was the ability to use EC2 Launch Templates with a Spot Fleet built by CloudFormation. With that challenge I figured I had a couple custom resources to build and I thought about how I could abstract that as much as possible, and I think I found it. I decided to build a direct interface to boto3 through CloudFormation.</p>
<p>Overall, I wrote this to aid in things such as quick lookups or utilizing new features and services before they get CloudFormation Support. It’s already working out for me. I tested it on Secrets Manager with in a week of the service being available and I’m able to retrieve secrets.</p>
<h2>How is it used?</h2>
<p><a href="https://github.com/dejonghe/cfn-boto-interface">The GitHub Repo</a> has more of a full rundown that includes building the zip, creating the Lambda Resource in CloudFormation, etc. You can use the pre built release package directly, as it’s a Zip file containing the code, cfn-response, and boto3==1.7.4. Here I’d just like to add an example and the high level documentation of what this object is made up of.</p>
<h3>Example: Secret String fom Secret Manager</h3>
<p>Note: Use GetAtt for secrets so that it doesn’t show up in CFN console as PhysicalResourceId</p>
<pre><code class="language-yaml">  SecretString:
    Type: Custom::FetchSecret
    Properties:
      # Reference to the Lambda Function that gets called
      ServiceToken: !GetAtt 'BotoInterface.Arn'
      # When a create event type is send to the lambda use this object
      Create:
        PhysicalResourceId: '!Create[0].VersionId' # Lookup and return secret when Ref'd
        ResponseData:                   # Key,Value pairs for GetAtt to use
          Secret: '!Create[0].SecretString'
        Commands:
          - Client: secretsmanager      # Boto3 client to use
            Method: get_secret_value    # method to call on the boto3.client('secretsmanager') object
            Arguments:                  # Keyword Arguments to pass to the method
              SecretId: !Ref 'SecretId'
      Update:
        Replace: 'True'                 # If an update is called just run create again,
                                        # CFN will send a delete on cleanup
</code></pre>
<h3>Custom Resource Properties</h3>
<h4>Top level properties</h4>
<ul>
<li>ServiceToken: (Required) - Arn of the Lambda Resource</li>
<li>Create: ActionObject, described below</li>
<li>Update: ActionObject, described below</li>
<li>Delete: ActionObject, described below</li>
</ul>
<h4>ActionObject</h4>
<ul>
<li>PhysicalResourceId: Physical Id of this resource to return to CloudFormation for this action. Can use <em>Lookups</em></li>
<li>ResponseData: Dict of key,value pairs to return to CloudFormation for this resource for this action, for use in GetAtt. Can use <em>Lookups</em></li>
<li>Commands: Array of CommandObjects</li>
<li>Replace: (Update Only) - Bool, will re run create, if a different PhysicalId is returned CloudFormation will send a Delete when Cleaning Up</li>
</ul>
<h4>CommandObjects</h4>
<ul>
<li>Client: (Required) - Boto3 client name to use when creating a client example: ‘ec2’, or ‘secretsmanager’</li>
<li>Method: (Required) - Method to call on the Boto3 client</li>
<li>Arguments: Dict of key,value pairs to pass to the method as keyword arguments.</li>
</ul>
<h4>Lookups</h4>
<p>Lookups are denoted with a <code>!</code> prefix. The lookups traverse dict objects by use of <code>.</code> notation</p>
<ul>
<li><code>!event</code>: Looks up a value in the event passed to the lambda from CloudFormation</li>
<li><code>!Create[]</code>: (Create ActionObject Only) - Looks up a value from the return of the command at that index ran in the Create ActionObject</li>
<li><code>!Update[]</code>: (Update ActionObject Only) - Looks up a value from the return of the command at that index ran in the Update ActionObject</li>
<li><code>!Delete[]</code>: (Delete ActionObject Only) - Looks up a value from the return of the command at that index ran in the Delete ActionObject</li>
</ul>
<h5>Modifiers</h5>
<p>If a lookup returns a value in a type that you need to cast you can use the modifiers after the lookup notation.</p>
<ul>
<li><code>!int</code>: Cast lookup to int</li>
<li><code>!str</code>: Cast lookup to str</li>
</ul>
<h4>Interpolation</h4>
<ul>
<li><code>!random</code>: Interpolates a random 4 Alpha Numeric string</li>
</ul>
<h2>Conclusion</h2>
<p>I was serious when I said this was dangerous, but then again it’s kind of cool. I hope others find use in it. If you have issues comment here or make an issue in GitHub. I’ll try to help out when I can.</p>

            </div>
        </article>

        <!-- Back to Blog Button -->
        <div class="mt-4">
            <a href="/blog/" class="btn btn-primary">Back to Blogssss</a>
        </div>
    </div>

    <!-- Footer -->
    
  <footer class="footer pt-5 mt-5">
    <hr class="horizontal dark mb-5">
    <div class="container">
      <div class=" row">
        <div class="col-md-3 mb-4 ms-auto">
          <div>
            <h6 class="text-gradient text-info font-weight-bolder">Expansive Labs</h6>
          </div>
          <div>
            <h6 class="mt-3 mb-2 opacity-8">Social</h6>
            <ul class="d-flex flex-row ms-n3 nav">
              <li class="nav-item">
                <a class="nav-link pe-1" href="https://www.facebook.com/people/Expansive-Labs/61573565235541/#" target="_blank">
                  <svg width="20" height="20" viewBox="0 0 32 32">
                       <image href="/static/assets/img/Facebook.svg" width="100%" height="100%" />
                    </svg>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link pe-1" href="htthttps://x.com/ExpansiveLabs" target="_blank">
                  <svg width="20" height="20" viewBox="0 0 32 32">
                       <image href="/static/assets/img/xSocial.svg" width="100%" height="100%" />
                    </svg>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link pe-1" href="https://github.com/" target="_blank">
                  <svg width="20" height="20" viewBox="0 0 32 32">
                       <image href="/static/assets/img/github.svg" width="100%" height="100%" />
                    </svg>
                </a>
              </li>
            </ul>
          </div>
        </div>
        <div class="col-md-2 col-sm-6 col-6 mb-4 me-auto">
          <div>
            <h6 class="text-gradient text-success text-sm">Company</h6>
            <ul class="flex-column ms-auto nav">
              <li class="nav-item">
               <a href="/about-us"> About Us </a>
              </li>
            </ul>
          </div>
        <div class="col-md-2 col-sm-6 col-6 mb-4 me-auto">
          <div>
                <p class="flex-column"><a href="mailto:support@expansivelabs.io">Support</a></p>
          </div>      
        </div>
        </div>
        <div class="col-md-2 col-sm-6 col-6 mb-4 me-auto">
          <div>
            <h6 class="text-gradient text-success text-sm">Legal</h6>
            <p xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"><span property="dct:title">Research and Training</span> by <a rel="cc:attributionURL dct:creator" property="cc:attributionName" href="https://expansivelabs.io">Expansive Labs LLC</a> is licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-SA 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1" alt=""></a></p>
            
            
          </div>
        </div>
        <div class="col-12">
        </div>
      </div>
    </div>
  </footer>

</body>
</html>
